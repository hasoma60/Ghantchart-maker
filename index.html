<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Costing Sheet - Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-screen-xl mx-auto p-2 md:p-4 space-y-6">
  <header class="bg-blue-600 text-white p-4 flex justify-between shadow-md sticky top-0 z-10">
    <h1 class="text-xl">Project Costing Sheet - Pro</h1>
    <span id="currentUser">Local</span>
  </header>
  <main class="p-4 space-y-4">
    <section id="projectControls" class="bg-white p-4 rounded shadow">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm mb-1" for="projectName">Project Name / Sheet ID</label>
          <input id="projectName" class="border rounded-md p-2 w-full" type="text" />
        </div>
        <div>
          <label class="block text-sm mb-1" for="sheetCurrency">Sheet Currency</label>
          <select id="sheetCurrency" class="border rounded-md p-2 w-full">
            <option value="USD">USD ($)</option>
            <option value="EUR">EUR (€)</option>
            <option value="AED">AED (د.إ)</option>
            <option value="OMR">OMR (ر.ع.)</option>
            <option value="SAR">SAR (ر.س)</option>
          </select>
        </div>
        <div class="flex flex-wrap items-end gap-2">
          <button id="loadProject" class="bg-gray-700 text-white px-3 py-2 rounded">Load/Switch Project</button>
          <button id="saveProject" class="bg-blue-600 text-white px-3 py-2 rounded">Save Local</button>
          <button id="exportExcel" class="bg-green-600 text-white px-3 py-2 rounded">Export Excel</button>
          <button id="downloadJson" class="bg-indigo-600 text-white px-3 py-2 rounded">Download JSON</button>
          <input type="file" id="importJson" class="hidden" accept="application/json" />
          <button id="importJsonBtn" class="bg-yellow-600 text-white px-3 py-2 rounded">Import JSON</button>
          <input type="file" id="importExcel" class="hidden" accept=".xlsx,.xls" />
          <button id="importExcelBtn" class="bg-purple-600 text-white px-3 py-2 rounded">Import Excel</button>
        </div>
      </div>
    </section>

    <section id="aiSearch" class="bg-white p-4 rounded shadow">
      <h2 class="text-lg mb-2">Intelligent Search (Gemini AI)</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
        <textarea id="geminiSearchQuery" class="border rounded-md p-2 w-full md:col-span-3" rows="3" placeholder="Enter your query..."></textarea>
        <input id="geminiApiKey" class="border rounded-md p-2 w-full" type="password" placeholder="API Key (optional)" />
        <input id="geminiModelName" class="border rounded-md p-2 w-full" type="text" placeholder="Model name" value="gemini-2.0-flash" />
        <button id="geminiSearchButton" class="bg-indigo-600 text-white px-3 py-2 rounded md:col-span-3">Search with AI</button>
      </div>
      <pre id="geminiSearchResults" class="border rounded-md p-2 bg-gray-50 h-32 overflow-auto"></pre>
    </section>

    <section id="itemForm" class="bg-white p-4 rounded shadow">
      <h2 class="text-lg mb-2">Add / Edit Cost Item</h2>
      <div class="mb-2">
        <label class="block text-sm mb-1" for="itemCategory">Category</label>
        <select id="itemCategory" class="border rounded-md p-2 w-full">
          <option value="other">Other</option>
          <option value="manpower">Manpower</option>
          <option value="tools">Tools Purchase</option>
          <option value="equipment">Equipment Rental</option>
        </select>
      </div>
      <div id="manpowerFields" class="hidden grid grid-cols-2 gap-2">
        <input id="manpowerDesignation" class="border rounded-md p-2" placeholder="Designation" />
        <input id="manpowerQty" type="number" class="border rounded-md p-2" placeholder="Personnel Qty" />
        <input id="manpowerSalaryRate" type="number" class="border rounded-md p-2" placeholder="Salary Rate" />
        <input id="manpowerSalaryUnit" class="border rounded-md p-2" placeholder="Salary Unit" />
        <input id="manpowerDuration" type="number" class="border rounded-md p-2" placeholder="Duration" />
        <select id="manpowerDurationUnit" class="border rounded-md p-2">
          <option value="day">Day(s)</option>
          <option value="week">Week(s)</option>
          <option value="month">Month(s)</option>
          <option value="year">Year(s)</option>
        </select>
        <input id="manpowerAccommodationRate" type="number" class="border rounded-md p-2" placeholder="Accommodation Rate" />
        <select id="manpowerAccommodationRateUnit" class="border rounded-md p-2">
          <option value="none">N/A</option>
          <option value="day">Per Day</option>
          <option value="week">Per Week</option>
          <option value="month">Per Month</option>
        </select>
        <select id="manpowerAccommodationType" class="border rounded-md p-2">
          <option value="none">Accommodation Type</option>
          <option value="shared">Shared</option>
          <option value="separate">Separate</option>
        </select>
        <input id="manpowerAccommodationSharedAmong" type="number" class="border rounded-md p-2" placeholder="Shared Among" />
        <input id="manpowerFlights" type="number" class="border rounded-md p-2" placeholder="Flights Cost p.p." />
        <input id="manpowerCarRentalRate" type="number" class="border rounded-md p-2" placeholder="Car Rental Rate" />
        <select id="manpowerCarRentalRateUnit" class="border rounded-md p-2">
          <option value="none">N/A</option>
          <option value="day">Per Day</option>
          <option value="week">Per Week</option>
          <option value="month">Per Month</option>
        </select>
        <select id="manpowerCarRentalType" class="border rounded-md p-2">
          <option value="none">Car Type</option>
          <option value="shared">Shared</option>
          <option value="separate">Separate</option>
        </select>
        <input id="manpowerCarRentalSharedAmong" type="number" class="border rounded-md p-2" placeholder="Car Shared Among" />
        <input id="manpowerVisa" type="number" class="border rounded-md p-2" placeholder="Visa Cost p.p." />
      </div>
      <div id="toolsFields" class="hidden grid grid-cols-2 gap-2">
        <input id="toolsDescription" class="border rounded-md p-2" placeholder="Description" />
        <input id="toolsQuantity" type="number" class="border rounded-md p-2" placeholder="Quantity" />
        <input id="toolsUnit" class="border rounded-md p-2" placeholder="Unit" />
        <input id="toolsRate" type="number" class="border rounded-md p-2" placeholder="Rate" />
      </div>
      <div id="equipmentFields" class="hidden grid grid-cols-2 gap-2">
        <input id="equipmentDescription" class="border rounded-md p-2" placeholder="Description" />
        <input id="equipmentQuantity" type="number" class="border rounded-md p-2" placeholder="Quantity" />
        <input id="equipmentUnit" class="border rounded-md p-2" placeholder="Unit" />
        <input id="equipmentRate" type="number" class="border rounded-md p-2" placeholder="Rate" />
      </div>
      <div id="otherFields" class="grid grid-cols-2 gap-2">
        <input id="otherDescription" class="border rounded-md p-2" placeholder="Description" />
        <input id="otherQuantity" type="number" class="border rounded-md p-2" placeholder="Quantity" />
        <input id="otherUnit" class="border rounded-md p-2" placeholder="Unit" />
        <input id="otherRate" type="number" class="border rounded-md p-2" placeholder="Rate" />
      </div>
      <input id="itemRemarks" class="border rounded-md p-2 mt-2 w-full" placeholder="Remarks (optional)" />
      <div class="mt-2 space-x-2">
        <button id="addItem" class="bg-green-600 text-white px-4 py-2 rounded">Add Item</button>
        <button id="cancelEdit" class="bg-gray-400 text-white px-4 py-2 rounded hidden">Cancel Edit</button>
      </div>
    </section>

    <section class="overflow-x-auto bg-white p-4 rounded shadow">
      <table class="min-w-full text-xs md:text-sm" id="itemsTable">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 sticky left-0 bg-gray-200">Sr.</th>
            <th class="p-2 sticky left-12 bg-gray-200">Category</th>
            <th class="p-2 sticky left-32 bg-gray-200">Desc/Design.</th>
            <th class="p-2">Qty/Pers.</th>
            <th class="p-2">Rate/Sal.</th>
            <th class="p-2">Unit/Sal.U.</th>
            <th class="p-2">MP Dur.</th>
            <th class="p-2">MP Dur.U.</th>
            <th class="p-2">Acc.Rate</th>
            <th class="p-2">Acc.Rate.U</th>
            <th class="p-2">Acc.Type</th>
            <th class="p-2">Acc.Shared</th>
            <th class="p-2">Flights</th>
            <th class="p-2">Car.Rate</th>
            <th class="p-2">Car.Rate.U</th>
            <th class="p-2">Car.Type</th>
            <th class="p-2">Car.Shared</th>
            <th class="p-2">Visa</th>
            <th class="p-2">Remarks</th>
            <th class="p-2">Amount</th>
            <th class="p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="itemsBody"></tbody>
      </table>
    </section>
    <div class="mt-4 text-right bg-white p-4 rounded shadow">
      <span class="font-bold">Grand Total: </span><span id="grandTotal">0</span>
    </div>
  </main>
  </div>

  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="text-white">Loading...</div>
  </div>
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-4 rounded shadow max-w-md">
      <h3 id="modalTitle" class="text-lg font-bold mb-2"></h3>
      <div id="modalBody" class="mb-4"></div>
      <button id="modalClose" class="bg-blue-600 text-white px-4 py-2 rounded">OK</button>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
